exports.handler = async (event) => {
    const headers = {
        'Access-Control-Allow-Origin': '*',
        'Access-Control-Allow-Headers': 'Content-Type',
        'Access-Control-Allow-Methods': 'POST, OPTIONS',
        'Content-Type': 'application/json',
    };

    if (event.httpMethod === 'OPTIONS') {
        return {
            statusCode: 200,
            headers,
            body: ''
        };
    }
    
    if (event.httpMethod !== 'POST') {
        return { 
            statusCode: 405, 
            headers,
            body: JSON.stringify({ error: 'Method Not Allowed' }) 
        };
    }
    
    try {
        const { playerName } = JSON.parse(event.body);
        
        console.log('Checking glitch effect for:', playerName);
        
        // Effetto speciale per Archibald
        if (playerName.toLowerCase() === "archibald") {

            const archibug = `                                                                   
                                                                                              .                                 
                                                                                             ::..                               
                                     .:.                                                     .:::.                              
                                    .::.                                                     :::::.                             
                                   .:::.                                                     :::::.                             
                                   .:::.                                                     ::::::.                            
                                   ::::.                                                     :::::::                            
                                   .:::.                                                     :::::::                            
                                   :::::.                                                    .::::::                            
                                   :::::.                                                   ..:::::::                           
                                  .:::::                                                     .:::::::                           
                                  ::::::.                                                    ::::::::                           
                                  .:::::.                                                    :::::::..                          
                                  .::::::.                                                  .::::::::.                          
                                  ::::::..                                                  .:::::::.                           
                                  ::::::::                                                  .::::::::                           
                                 .:::::::.                                                  ::::::::.                           
                                  .:::::::.                                                 :::::::.                            
                                 ..:::::::.                                                .:::::::.                            
                                  .::::::::                                                :::::::.                             
                                   .:::::::.                                             ..:::::::                              
                                    :::::::.                                             .::::::::                              
                                     :::::::.                                          .:::::::::                               
                                      ::::::::.                                     ..::::::::::.                               
                                       :::::::::::...                             ..:::::::::::                                 
                                        .::::::::::::.                          ..:::::::::::.                                  
                                          :::::::::::                          .::::::::::::                                    
                                            .::::::::                         ::::::::::::                                      
                                              .::::::::                     .:::::::::.                                         
                                                .:::::::::.              .::::::::::.                                           
                                                  ::::::::::::        ::::::::::::.                                             
                                                    :::::::::::::::::::::::::::::                                               
                                                     ..:::::::::::::::::::::::                                                  
                                                        .:::::::::::::::::.                                                     
                                                        .::::::::::::::::::.                                                    
                                                      .::::::::::::::::::::::..                                                 
                                                    .::::::::.          .::::::::  ..                                           
                                                 :::::::::.                .:::::::::::.                                        
                                              .:::::::.                       .:::::::::                                        
                                             ::::::::                           .:::::::.                                       
                                            ::::::::                             .:::::::                                       
                                           .:::::::                               .::::::                                       
                                            :::::::                                ::::::                                       
                                            .::::::.                               ::::.                                        
                                             ..:::::..                           .::::                                          
                                                  :::.                          :::::.                                          
                                                   .:::.                     .::::::.                                           
                                                     :::::.              .:::::::.                                              
                                                       .:::::::... .:::::::::::..                                               
                                                        .:::::::::::::::::::.                                                   
                                                 .:         .::::::::::::.  .                                                   
                                             .:::::   .::::::::::::::::::::::..   :                                             
                                           .:::::::::::::::::::::::::::::::::::.:::::.                                          
                                        ..:::::::::::::::::::::::::::::::::::::::::::::::.                                      
                                       .:::::::::::::::::::.  ..::::::...::::::::::::::::::.                                    
                                     .::::::::::::::::::.       :::::.     .::::::::::::::::.                                   
                                   .:::::::::::.                ::::::        .::::::::::::::::.                                
                                 ::::::::::::.                  :::::.         .::::::::::::::::.                               
                               .::::::::::.                    .:::::.                 .::::::::::.                             
                              .:::::::::.                      .:::::                     ::::::::::.                           
                             .::::::::..                       ::::::.                     .:::::::::.                          
                           .:::::::::.                         ::::::                        .::::::::.                         
                          .::::::::. .                         :::::.   .                     .:::::::::                        
                         .::::::::.                            :::::.. ..                       :::::::::                       
                        :::::::::.                           . :::::  :::                        ::::::::.                      
                        ::::::::                            .:.:::::.::::                         ::::::::.                     
                       .:::::::                             :::::::::::::                          ::::::::                     
                      .:::::: .:.                          ::::::::::::::                          .::::::::                    
                     .::::::.                              :::::::::::::.                           .:::::::.                   
                     .:::::                                :::::::::::::.                            .::::::.                   
                     :::::.                                 :::::::::::::                              ::::::                   
                     :::::.                                  ::::::::::::                              .:::::.                  
                     .:::                                     :::::::::::                               .:::::                  
                     .::.                                     :::::::::::                                :::::                  
                      :.                                      :::::::::::                                .::::                  
                                                              :::::::::::.                               .::::.                 
                                                              .::::::::. :                                ::::.                 
                                                               ::::::::                                    :::.                 
                                                               ::::::::                                    .::                  
                                                               ::::::::                                     .                   
                                                               ::::::::                                     .                   
                                                               :::::::.                                                         
                                                               :::::::.                                                         
                                                               .::::::                                                          
                                                               .:::::.                                                          
                                                               .:::::.                                                          
                                                                :::::.                                                          
                                                                :::::.                                                          
                                                                :::::                                                           
                                                                ::::.                                                           
                                                                ::::.                                                           
                                                                ::::.                                                           
                                                                .:::.                                                           
                                                                 :::.                                                           
                                                                 :::.                                                           
                                                                 .::                                                            
                                                                  :.                                                            
                                                                  ::.                                                           
                                                                  ::                                                            
                                                                  :.                                                            
                                                                  .                                                                                                                                                                                                      
        `;
    
        const o_to_second_bug = `
        ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣀⣀⣀⣀⣀⣀⣀⣀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
        ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣠⣴⣾⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣶⣤⣀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
        ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣤⣾⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣷⣤⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
        ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣠⣾⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣦⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀
        ⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣾⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣄⠀⠀⠀⠀⠀⠀⠀⠀
        ⠀⠀⠀⠀⠀⠀⠀⠀⢀⣾⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡿⠟⠛⠛⠛⠛⠻⢿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣆⠀⠀⠀⠀⠀⠀⠀
        ⠀⠀⠀⠀⠀⠀⠀⢠⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⠟⠋⠁⠀⠀⠀⠀⠀⠀⠀⠀⠙⢿⣿⣿⣿⣿⣿⣿⣿⣿⡄⠀⠀⠀⠀⠀⠀
        ⠀⠀⠀⠀⠀⠀⢠⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡟⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠹⣿⣿⣿⣿⣿⣿⣿⣿⠀⠀⠀⠀⠀⠀
        ⠀⠀⠀⠀⠀⠀⣾⣿⣿⣿⣿⣿⣿⣿⣿⣿⡟⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠸⣿⣿⣿⣿⣿⣿⣿⣇⠀⠀⠀⠀⠀
        ⠀⠀⠀⠀⠀⢸⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣿⣿⣿⣿⣿⣿⣿⣿⠀⠀⠀⠀⠀
        ⠀⠀⠀⠀⠀⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣿⣿⣿⣿⣿⣿⣿⣿⠀⠀⠀⠀⠀
        ⠀⠀⠀⠀⠀⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣿⣿⣿⣿⣿⣿⣿⣿⠀⠀⠀⠀⠀
        ⠀⠀⠀⠀⠀⢻⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣿⣿⣿⣿⣿⣿⣿⡟⠀⠀⠀⠀⠀
        ⠀⠀⠀⠀⠀⠸⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡄⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢠⣿⣿⣿⣿⣿⣿⣿⠇⠀⠀⠀⠀⠀
        ⠀⠀⠀⠀⠀⠀⢿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣿⣿⣿⣿⣿⣿⣿⡿⠀⠀⠀⠀⠀⠀
        ⠀⠀⠀⠀⠀⠀⠈⢿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣷⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣾⣿⣿⣿⣿⣿⣿⡿⠁⠀⠀⠀⠀⠀⠀
        ⠀⠀⠀⠀⠀⠀⠀⠈⢿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣶⣤⣀⡀⠀⠀⠀⠀⢀⣀⣤⣾⣿⣿⣿⣿⣿⣿⣿⡿⠁⠀⠀⠀⠀⠀⠀⠀
        ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠻⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⠟⠀⠀⠀⠀⠀⠀⠀⠀⠀
        ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⠛⢿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡿⠛⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
        ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⠙⠻⢿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡿⠟⠋⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
        ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⠉⠙⠛⠛⠛⠛⠛⠛⠛⠉⠉⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀

                        S Y S T E M   F A I L U R E
                UNAUTHORIZED ACCESS: ARCHIBALD DETECTED
                CONTAINMENT BREACH IMMINENT
                `;
            
            return {
                statusCode: 200,
                headers,
                body: JSON.stringify({
                    effect: 'ascii_art',
                    art: archibug,  // Usa la variabile corretta qui
                    closePage: true
                })
            };
        }
        
        // Nessun effetto speciale per altri nomi
        return {
            statusCode: 200,
            headers,
            body: JSON.stringify({ 
                effect: 'none',
                message: 'No special effects for this user'
            })
        };
    } catch (error) {
        console.error('Error in glitch-effect:', error);
        return {
            statusCode: 500,
            headers,
            body: JSON.stringify({ 
                error: 'Internal Server Error: ' + error.message,
                effect: 'none'
            })
        };
    }
};